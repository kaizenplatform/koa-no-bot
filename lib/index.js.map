{"version":3,"file":"index.js","sourceRoot":"/src","sources":["index.coffee"],"names":[],"mappings":"AAAA,IAAA;;AAAA,UAAA,GAAa,SAAC,OAAD;AACX,MAAA;EAAA,MAAqB,OAAA,IAAW,EAAhC,EAAE,eAAF,EAAQ;EACR,SAAA,OAAS,UAAU,CAAC;EACpB,aAAA,WAAa,SAAC,GAAD,EAAM,EAAN;IACX,OAAO,CAAC,GAAR,CAAY,QAAA,GAAS,GAAG,CAAC,IAAb,GAAkB,IAAlB,GAAsB,GAAG,CAAC,MAA1B,GAAiC,IAA7C,EAAkD,EAAlD;WACA,IAAC,EAAA,KAAA,EAAD,CAAO,GAAP;EAFW;SAIb,UAAC,IAAD;AACE,QAAA;IAAA,EAAA,GAAK,MAAA,CAAO,IAAC,CAAA,GAAD,CAAK,YAAL,CAAP;AACL,SAAA,sCAAA;;MACE,IAAG,EAAE,CAAC,KAAH,CAAS,GAAG,CAAC,MAAb,CAAH;QACE,QAAQ,CAAC,KAAT,CAAe,IAAf,EAAkB,CAAC,GAAD,EAAM,EAAN,CAAlB;AACA,eAFF;;AADF;WAIA,CAAA,MAAM,IAAN;EANF;AAPW;;AAeb,UAAU,CAAC,YAAX,GAA0B;EAAC;IACzB,IAAA,EAAM,cADmB;IAEzB,MAAA,EAAQ,2GAFiB;GAAD,EAGxB;IACA,IAAA,EAAM,eADN;IAEA,MAAA,EAAQ,uBAFR;GAHwB;;;AAQ1B,MAAM,CAAC,OAAP,GAAiB","sourcesContent":["middleware = (options) ->\n  { bots, callback } = options || {}\n  bots ||= middleware.default_bots\n  callback ||= (bot, ua) ->\n    console.log \"Found #{bot.name} (#{bot.regexp}):\", ua\n    @throw 403\n\n  (next) ->\n    ua = String(@get(\"user-agent\"))\n    for bot in bots\n      if ua.match(bot.regexp)\n        callback.apply(@, [bot, ua])\n        return\n    yield next\n\nmiddleware.default_bots = [{\n  name: \"General Bots\"\n  regexp: /(bot\\b|spider\\b|crawler\\b|\\bwget\\b|\\bcurl\\b|Yahoo ad|slurp|Mediapartners-Google|YahooSeeker|BingPreview)/i\n},{\n  name: \"No User Agent\"\n  regexp: /^(|null|undefined|)$/i\n}]\n\nmodule.exports = middleware\n"]}